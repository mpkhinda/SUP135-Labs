---
title: "Lab 1"
author: "Matt Khinda"
date: "2/3/2023"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

if (!require(haven)) install.packages("haven"); library(haven)
if (!require(tidyverse)) install.packages("tidyverse"); library(tidyverse)
if (!require(ggplot2)) install.packages("ggplot2"); library(ggplot2)
if (!require(here)) install.packages("here"); library(here)
```

## Load Data

```{r load data, include=FALSE}
# Load dataset found in the folder "datasets" in the working directory 
nlsy <- read_dta(here("datasets", "nlsy97.dta"))

```

## Question 1: Histogram

```{r hist, echo=FALSE}
inc_hist <- ggplot(nlsy) +
  geom_histogram(aes(x = kid_income), bins = 50)

inc_hist
```

## Question 2: Mean

```{r mean, echo=FALSE}
inc_mean <- mean(nlsy$kid_income, na.rm = TRUE)
cat("The mean income is $", inc_mean, sep="")
```

## Question 3: Conditional Variables

#### 3a: Below the mean
```{r cond_1, echo=FALSE}
nlsy <- nlsy %>% mutate(below_mean = ifelse(nlsy$kid_income > inc_mean, 0, 1))
```

#### 3b: Average below mean
```{r cond_2, echo=FALSE}
pct_below_mean <- mean(nlsy$below_mean)
cat("The percent of children below the mean income is ", pct_below_mean*100, "%", sep = "")
```

#### 3c: Why is it not 50%?
```{r cond_3, echo=FALSE}
paste("Because the distribution shown above in the histogram is not normal")
```

## Question 4: Median

```{r med, echo=FALSE}
inc_med <- median(nlsy$kid_income, na.rm = TRUE)
cat("The median income is $", inc_med, sep = "")
```

## Question 5: Standard Deviation

```{r sd, echo=FALSE}
inc_sd <- sd(nlsy$kid_income)
cat("One stanard deviation of income is equal to $", inc_sd, sep = "")
```

## Question 6: Wihtin 1 or 2 Standard Deviations

```{r within_sd, echo=FALSE}
nlsy <- nlsy %>% mutate(sd1 = ifelse(abs(nlsy$kid_income - inc_mean) < inc_sd, 1, 0))
nlsy <- nlsy %>% mutate(sd2 = ifelse(abs(nlsy$kid_income - inc_mean) < inc_sd*2, 1, 0))

cat("The percent of children within one standard deviation is ", mean(nlsy$sd1)*100, "%. ", sep = "")
cat("The percent of children within two standard deviations is ", mean(nlsy$sd2)*100, "%.", sep = "")
```

## Question 7: Percentile Ranks

#### 7a: Rank incomes
```{r pct ranks, echo=FALSE}
nlsy <- nlsy %>% mutate(kid_inc_rank = rank(nlsy$kid_income, na.last = TRUE))
```

#### 7b: Sort by rank
```{r sort ranks, echo=FALSE}
nlsy[order(nlsy$kid_inc_rank),]
```
#### 7c: Normalize rank
```{r normal ranks, echo=FALSE}
# Overwrite kid_inc_rank with new percentile ranks
nlsy <- nlsy %>% mutate(kid_inc_rank = percent_rank(nlsy$kid_income)*100)
```



## Question 8: Percentile Rank Distribution

#### 8a: Plot percentile rank distribution
```{r rank hist, echo=FALSE}
ggplot(nlsy) +
  geom_histogram(aes(x = kid_inc_rank), bins = 50)
```

#### 8b: Validate percentile rank mean and median
```{r rank mean_med, echo=FALSE}
inc_pctrnk_mean <- mean(nlsy$kid_inc_rank, na.rm = TRUE)
inc_pctrnk_med <- median(nlsy$kid_inc_rank, na.rm = TRUE)

cat("The mean percentile rank is", inc_pctrnk_mean, " while the median percentile rank is", inc_pctrnk_med)
```








